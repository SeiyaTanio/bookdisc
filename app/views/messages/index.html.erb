<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-8 bg-info">
      <div class="sticky-top p-2">
        <div class="row d-flex justify-content-between align-items-center">
          <div class="col-6">
            <%= @room.room_name %>
          </div>
          <div class="col-6 d-flex justify-content-end">
            <% if user_signed_in? && current_user.id == @host_id %>
              <a class="btn btn-outline-primary mx-2" href="/rooms/<%=@room.id%>/edit" role="button">編集</a>
              <%= link_to '削除', room_path(params[:room_id]), method: :delete , class:"btn btn-outline-primary"%>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row justify-content-center" style="height: 80vh; overflow: scroll;">
    <div class="col-8 border border-bottom-0">
      <% @messages.each do |message| %>
        <% if message.user_id == current_user.id %>
          <div class="row py-3 justify-content-end" style="text-align: right;">
            <p><small class="text-muted "><%= l message.updated_at %></small></p>
            <div class="mycomment col-9 ">
              <p class="text-start shadow"><%= message.sentence %></p>
            </div>
          </div>
        <% else%>
          <div class="row py-3">
            <div class="col-2" >
              <div data-bs-toggle="tooltip" data-bs-placement="top" title="このユーザーのページに移動">
                <% if message.user.profile.present? && message.user.profile.image.present?%>
                  <%= link_to image_tag(message.user.profile.image, class:"rounded mx-auto d-block", style: "max-width: 100px; max-height: 100px;"), "#" %>
                <% else %>
                  <%= link_to image_tag("bookdisc-icon-image.png", class:"rounded mx-auto d-block", style: "max-width: 100px; max-height: 100px;"), "#" %>
                <% end %>
              </div>
            </div>
            <div class="col-10">
              <p><%= message.user.nickname %><br><small class="text-muted "><%= l message.updated_at %></small></p>
            </div>
            <div class="col-9 m-1">
              <div class="says shadow">
                <p><%= message.sentence %></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  <%= form_with(model: [@room,@message], class: "needs-validation row justify-content-center", html: {novalidate: true}, local: true) do |f| %>
    <div class="col-8 border border-top-0 ">
      <div class="row align-items-center mb-3">
        <div class = "col-10">
          <%= f.text_area :sentence, class: "form-control ", maxlength: "150", autofocus: true , required: true ,placeholder: 'Message:150文字以内'%>
        </div>
        <div class = "col-2">
          <%= f.submit "送信", class:"btn btn-lg btn-primary" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style>
.says {
  display: inline-block;
  position: relative; 
  padding: 8px;
  margin-top: -15px;
  border-radius: 12px;
  background: #edf1ee;
}

.says:after {
  content: "";
  display: inline-block;
  position: absolute;
  top: 3px; 
  left: -19px;
  border: 8px solid transparent;
  border-right: 18px solid #edf1ee;
  -webkit-transform: rotate(35deg);
  transform: rotate(35deg);
}

.says p {
  white-space: pre-wrap;
  word-wrap: break-word;
}

.mycomment {
  margin-top: -15px;
}

.mycomment p {
  display: inline-block;
  position: relative; 
  margin: 0 10px 0 0;
  padding: 8px;
  border-radius: 12px;
  background: #30e852;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.mycomment p:after {
  content: "";
  position: absolute;
  top: 3px; 
  right: -19px;
  border: 8px solid transparent;
  border-left: 18px solid #30e852;
  -webkit-transform: rotate(-35deg);
  transform: rotate(-35deg);
}
</style>