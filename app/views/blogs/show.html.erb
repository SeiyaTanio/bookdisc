<div class="container container-style">
  <div class="row p-4 p-md-5 my-4 text-white rounded bg-dark">
    <div class="col-md-6 px-0">
      <h1 class="display-4 fst-italic">Blog</h1>
      <p class="lead my-3">Multiple lines of text that form the lede, informing new readers quickly and efficiently about what’s most interesting in this post’s contents.</p>
    </div>
  </div>
  <div class="row pb-3">
    <div class="col-9">
      <div class="row border mb-5" style="min-height: 350px">
        <div class="row g-0 p-3 border-bottom" style="min-height: 150px">
          <h2><%= @blog.title %></h2>
          <p class=""><small class="text-muted"><%= l @blog.updated_at %></small></p>
          <%= image_tag "no-image.png", class:"my-4"%>
          <div class="new-line py-4"><%= @blog.article %></div>
        </div>
        <div class="row g-0 align-items-center justify-content-center">
          <div class="col-4">
            <div class="text-center"><small class="text-muted"><%= @blog.b_comments.count %>件のコメント</small></div>
            <div class="d-flex justify-content-center">
              <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                <i class="bi bi-chat-left" style="font-size: 25px;"></i>
              </button>
            </div>
          </div>
          <div class="col-4">
            <div class="text-center"><small class="text-muted">1件のいいね</small></div>
            <div class="d-flex justify-content-center">
              <%= link_to '', "#", class:"bi bi-heart-fill like-icon" %>
            </div>
          </div>
        </div>
      </div>
      <div class="row py-1 bg-secondary" style="height: 50px;">
        <div class="d-flex align-items-center justify-content-center text-white">コメント</div>
      </div>
      <% @b_comments.each do |comment|%>
        <div class="row border">
          <div class="row g-0 mt-3">
            <div class="col-3">
              <div data-bs-toggle="tooltip" data-bs-placement="top" title="このユーザーのページに移動">
                <% if comment.user&.profile&.image %>
                  <%= link_to image_tag(comment.user.profile.image, class:"rounded-circle mx-auto d-block user-icon"), user_path(comment.user_id) %>
                <% else %>
                  <%= link_to image_tag("bookdisc-icon-image.png", class:"rounded-circle mx-auto d-block user-icon"), user_path(comment.user_id) %>
                <% end %>
              </div>
            </div>
            <div class="col-9 my-auto">
                <h4 class="text-truncate"><%= comment.user.nickname %></h4>
            </div>
          </div>
          <div class="row g-0 p-3">
            <p class="new-line"><%= comment.b_text %></p>
          </div>
          <div class="row g-0 ps-3">
            <p class=""><small class="text-muted"><%=l comment.updated_at %></small></p>
          </div>
        </div>
      <% end %>
    </div>

    <div class="col-3 sticky-nav">
      <div class="row px-2 mt-3" style="max-height: 90vh; overflow: scroll;">
        <% if user_signed_in? && current_user.id == @blog.user_id %>
          <h3 class="text-center fst-italic fw-light text-decoration-underline">Blog</h3>
          <div class="p-2 mb-3 d-flex justify-content-around">
            <a class="btn btn-outline-primary" href="/blogs/<%=@blog.id%>/edit" role="button">編集</a>
            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#destroyBackdrop">
              削除
            </button>
          </div>
        <% end %>
        <div class="row g-0 align-items-center">
          <div class="col-6">
            <div class="text-center"><small class="text-muted"><%= @blog.b_comments.count %>件のコメント</small></div>
            <div class="d-flex justify-content-center">
              <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                <i class="bi bi-chat-left" style="font-size: 25px;"></i>
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center"><small class="text-muted">1件のいいね</small></div>
            <div class="d-flex justify-content-center">
              <button type="button" class="btn btn-link">
              <%= link_to '', "#", class:"bi bi-heart-fill like-icon" %>
              </button>
            </div>
          </div>
        </div>
        <div class="row g-0 border shadow py-2 my-2">
          <h3 class="text-center fst-italic fw-light text-decoration-underline">Profile</h3>
          <div class="mt-2" >
            <div data-bs-toggle="tooltip" data-bs-placement="top" title="このユーザーのページに移動">
              <% if @blog.user.profile.present? && @blog.user.profile.image.present?%>
                <%= link_to image_tag(@blog.user.profile.image, class:"rounded-circle mx-auto d-block user-icon"), user_path(@blog.user_id) %>
              <% else %>
                <%= link_to image_tag("bookdisc-icon-image.png", class:"rounded-circle mx-auto d-block user-icon"), user_path(@blog.user_id) %>
              <% end %>
            </div>
          </div>
          <div class="mt-2">
            <h4 class="text-center"><%= @blog.user.nickname %></h4>
          </div>
          <div class="text-center">
            <div>
              <a href="/users/<%=@blog.user_id%>/relationships" class="link-secondary text-decoration-none"><b>フォロー</b>  100人</a>
            </div>
            <div>
              <a href="#" class="link-secondary text-decoration-none"><b>フォロワー</b>  50人</a>
            </div>
          </div>
          <div class="mt-3 d-flex justify-content-center">
            <% if user_signed_in? && current_user.id == @blog.user_id %>
              <% if @blog.user.profile.present? %>
                <a class="btn btn-outline-primary" href="/profiles/<%=@blog.user.profile.id%>/edit" role="button">プロフィール編集</a>
              <% else %>
                <a class="btn btn-outline-primary" href="/profiles/new" role="button">プロフィール作成</a>
              <% end %>
            <% elsif current_user.following?(@blog.user) %>
                <%= link_to 'フォロー解除', user_relationship_path(current_user.id, current_user.relationships.find_by(follower: @blog.user)), method: :delete , class:"btn btn-outline-primary" %>
            <% else %>
                <%= link_to 'フォロー', user_relationships_path(user_id: current_user.id, follower: @blog.user), method: :post, class:"btn btn-outline-primary" %>
            <% end %>
          </div>
          <div class="row mt-3">
            <div class="mb-1">自己紹介</div>
            <div class="text-black-50"><small>
              <% if @blog.user.profile.nil?%>
                未登録
              <% elsif @blog.user.profile.self_introduction.nil? %>
                自己紹介を登録してください
              <% else %>
                <%= @blog.user.profile.self_introduction %>
              <% end %>
            </small></div>
          </div>
          <div class="row mt-3">
            <div class="mb-1">お気に入りの本</div>
            <div class="text-black-50"><small>
              <% if @blog.user.profile.nil? %>
                未登録
              <% elsif @blog.user.profile.favorite_book.nil? %>
                お気に入りの本を登録してください
              <% else %>
                <%= @blog.user.profile.favorite_book %>
              <% end %>
            </small></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <%= form_with model: @b_comment, url:blog_b_comments_path(@blog.id), local: true do |f| %>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">コメント</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-0 pb-2">
            <div class="col-1">
              <div>
                <% if current_user&.profile&.image %>
                  <%= image_tag current_user.profile.image, class:"rounded-circle d-block", style:"height: 40px; width: 40px" %>
                <% else %>
                  <%= image_tag "bookdisc-icon-image.png", class:"rounded-circle d-block", style:"height: 40px; width: 40px" %>
                <% end %>
              </div>
            </div>
            <div class="col-10 my-auto ps-3">
              <div class="fs-6 text-truncate"><%= current_user.nickname %></div>
            </div>
          </div>
          <%= f.text_area :b_text, class: "form-control ", maxlength: "150", rows: "5", autofocus: true %>
        </div>
        <div class="modal-footer">
          <%= f.submit "投稿", class:"btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="modal fade" id="destroyBackdrop" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="destroyBackdropLabel">削除してもよろしいですか？</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cansel</button>
        <%= link_to 'OK', blog_path(params[:id]), method: :delete , class:"btn btn-primary"%>
      </div>
    </div>
  </div>
</div>